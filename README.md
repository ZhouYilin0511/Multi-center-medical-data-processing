# Multi-center-medical-data-processing
多中心中西医结合中文电子病历规范化处理
本项目致力于实现对多中心来源的中西医结合中文电子病历（EMR）数据的高效、结构化与语义规范化处理。针对来自不同医疗机构、格式与结构各异的异构电子病历数据，我们构建了一套可扩展、可维护、基于大语言模型的自动化处理流程。依托于大语言模型 DeepSeek-R1 提供的 API 接口，在零样本条件下实现对原始非结构化医疗文本的深度语义解析与规范化处理，有效统一多源异构数据的表达，支持跨机构医疗数据的管理与科研应用。

## 项目背景
电子病历系统在不同医院中通常存在数据结构、存储方式和内容规范的显著差异，这种异构性为多中心临床研究与合作带来极大挑战。本项目提出了一种基于大语言模型的通用处理框架，无需依赖本地训练或微调，即可在数据本地化的前提下实现对多源异构电子病历的高效、自动化规范化处理，尤其适用于中西医结合场景下的复杂病历数据处理。

## 主要功能
多中心数据适配：支持来自多个医院的数据独立处理，按医院目录划分，保持原始结构。每个中心可单独配置处理流程与提示词模板，方便扩展与维护。
结构化解析与预处理：
  支持 .xlsx 和 .txt 格式的电子病历数据。
  对 .xlsx 文件，系统以住院号为单位创建独立目录，提取每类病历内容并存储为 .txt 文件，统一命名规范。
  对原始 .txt 病历文件：
    去标识化处理：删除或替换患者姓名、住院号、科室、医生姓名等敏感信息，保障数据隐私。
    文本清洗处理：剔除冗余空格、乱码、特殊符号等，提升文本质量。
  基于时间戳对长文本（如"病程记录"）进行自动拆分，生成独立文档。
提示词驱动的 LLM 规范化：
  通过定制化提示词模板匹配不同病历类型。提示词模板双机制匹配：静态映射：按文件名精确匹配提示词模板。动态匹配：结合关键词与规则库智能识别病历类型，匹配最合适的提示词。
  调用 DeepSeek-R1 API 进行语义解析与规范化输出。
批量与单例处理模式：支持通过配置文件灵活选择处理方式。支持单个病历文件处理（调试或测试）；支持目录级批量处理，适用于大规模数据规范化任务。
模块化设计与可扩展性：
  支持快速新增提示词模板，适应规范变更或新类型病历文件。
  支持新医院数据快速接入，保持原始目录结构与独立配置。
  框架高度解耦，便于维护、迭代与跨中心部署。
实现从原始数据到标准化输出的全流程自动化处理，保持目录结构一致性，确保结果可追溯，处理日志记录，便于监控和调试。

## 项目结构
project-root/
│
├── README.md 
│
├── hospital_a/  
│   ├── config.py                  # 配置文件，用于设置 API 等信息
│   ├── prompts/                   # 提示词模板目录
│   │   ├── 入院记录-主诉提示词.txt
│   │   ├── 入院记录提示词.txt
│   │   └── ...
│   ├── txttojointtoLLM-own-Batchprocessing.py   # 规范化处理脚本
│   └── ...                        # 原始/处理后病历数据文件及目录
│
├── hospital_b/ 
│
└── hospital_c/ 

## 使用说明
1. 环境配置
确保安装以下依赖：
pip install pandas openpyxl siliconflow
2. 配置 API
在 config.py 中填入你的 DeepSeek-R1 API 密钥：
API_KEY = "your_api_key_here"
3. 运行处理脚本
使用以下命令启动处理流程：
python txttojointtoLLM-own-Batchprocessing.py
脚本将遍历指定医院目录，按患者住院号逐一处理，并输出规范化后的文本。
4. 提示词定制
可在 prompts/ 目录下自定义不同病历类型（如“入院记录”“病程记录”等）对应的提示词模板，以适配不同医院的表述习惯。

## 数据处理流程
1.数据准备与清洗：
  对 Excel 数据进行解析并转换为 TXT；
  对原有 TXT 数据进行去标识化和清理冗余符号。
2.类型识别与提示词匹配：
  根据文件名动态匹配预定义的提示词模板。
3.API 调用与规范化：
拼接提示词与病历文本，调用 DeepSeek-R1 接口进行处理。
4.结果存储：
输出结构化和规范化后的文本，保留原目录结构。

## 实验结果
本项目在 1563 例多中心膝骨关节炎（KOA）电子病历 上进行了系统化验证。通过采用 DeepSeek-R1 大模型进行零样本规范化处理，并结合专业团队的多轮抽样与人工校验，最终实现了 86% 以上的平均规范化准确率。该方法显著提升了多中心医疗数据处理的一致性、语义准确性与可用性，具体优势包括：
处理效率显著提升：大幅降低人工处理成本与时间开销。
语义准确率高：深度解析中西医结合文本的复杂语义。
模型免训练，使用门槛低：无需微调，开箱即用，适配多中心场景。
可拓展性与可维护性强：可快速接入新医院、新病历类型与新规范标准。
<img width="579" height="317" alt="image" src="https://github.com/user-attachments/assets/235006d3-72da-453b-af38-9fe4b189d350" />
## 技术创新点
零样本语义处理：无需本地训练或微调模型，直接调用 API 即可对原始病历文本进行语义解析与规范化，降低使用门槛。
模块化提示词设计：提示词模板可灵活扩展与更新，适配不同病历类型与规范版本，提升系统的可维护性与拓展性。
数据本地化 + 全局规范化：所有数据处理均在本地完成，保障隐私与安全的前提下，实现多中心间的标准统一。
系统化自动处理流程（Pipeline）：从原始病历解析、文本清洗、结构组织到语义规范化，构建完整自动化处理链路，提升处理效率与稳定性。

## 后续计划
扩展支持更多病历类型与医院数据标准；
将进一步深化提示词模板的结构与策略设计，提升模型在细粒度信息提取、语义补全及复杂症状表达处理方面的准确性与鲁棒性；
基于大模型对上下文的理解能力，引入动态纠错机制，增强对模糊、冗余或歧义表达的语义解析能力；
推出可视化配置界面，降低使用门槛；
为下游任务如结构化标注与知识抽取提供了高质量基础，有力支撑了中西医结合专病知识图谱的构建与智能医学决策。

## 致谢
本项目得以顺利实施，离不开以下单位与个人的支持与贡献：
  感谢 硅基流动平台（SiliconFlow） 提供稳定高效的 API 服务通道，使本项目能够便捷地接入 DeepSeek-R1 大语言模型，实现医疗文本的自动化语义解析与规范化处理。
  感谢 各合作医院 提供高质量的脱敏电子病历数据，为多中心数据处理框架的验证提供了坚实基础。
  特别感谢 参与规则制定的医学专家与信息学工程师，他们共同构建了覆盖多种病历类型的提示词体系与处理规则。
  感谢 参与数据标注与结果校验工作的医学与信息学跨学科团队，其成员在系统培训后完成了多轮细致校对，为实验数据的可靠性与评估结果的严谨性提供了保障。
